# EV Charge Bot - –°—Ç–∞—Ç—É—Å —Ç–∞ –ü—Ä–æ–±–ª–µ–º–∏

## üéâ –ü–û–¢–û–ß–ù–ò–ô –°–¢–ê–ù (21.08.2025 22:00) - –û–ù–û–í–õ–ï–ù–û

### ‚úÖ –©–û –ü–†–ê–¶–Æ–Ñ (–ü–û–í–ù–Ü–°–¢–Æ –í–ò–ü–†–ê–í–õ–ï–ù–û):
- **Telegram –±–æ—Ç**: [@ev_charge_tracker_bot](https://t.me/ev_charge_tracker_bot)
- **–¢–æ–∫–µ–Ω**: `8499449869:AAEmGz5Puqzetv14PjPhPeH8FmhAeOKIdfw`
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –≤–ª–∞—Å–Ω–∏–∫–∞**: Chat ID `495068248` —Ä–æ–∑–ø—ñ–∑–Ω–∞—î—Ç—å—Å—è
- **–£—Å—ñ –∫–æ–º–∞–Ω–¥–∏**: `/start`, `/new`, `/finish`, `/status`, `/tariff` –ø–æ–≤–Ω—ñ—Å—Ç—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ
- **OCR –æ–±—Ä–æ–±–∫–∞**: Tesseract.js –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é + timeout –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –∫—Ä–∞—à—ñ–≤
- **Session management**: –ø–æ–≤–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Å—ñ—è–º–∏ –∑–∞—Ä—è–¥–∫–∏
- **Tariff system**: –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–∞—Ä–∏—Ñ—ñ–≤ –∑–∞ –º—ñ—Å—è—Ü—è–º–∏
- **Reports**: PDF —Ç–∞ CSV –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è (CSV –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ)
- **HEIC –ø—ñ–¥—Ç—Ä–∏–º–∫–∞**: –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è iPhone —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ Sharp
- **Smart number recognition**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑—Ä—ñ–∑–Ω–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫ vs –µ–∫—Ä–∞–Ω –∑–∞—Ä—è–¥–∫–∏
- **Database fallback**: –ø–æ–≤–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ development mode –±–µ–∑ PostgreSQL
- **–Ü–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∏**: –≤—Å—ñ callback –∑–∞–ø–∏—Ç–∏ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ
- **–õ–æ–≥—É–≤–∞–Ω–Ω—è**: –ø–æ–≤–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

### üîß AZURE INFRASTRUCTURE (–†–û–ó–ì–û–†–ù–£–¢–û):
- **‚úÖ Resource Group**: `ev-charge-bot-rg` (Poland Central)
- **‚úÖ App Service**: `ev-charge-bot` (Running) - ev-charge-bot.azurewebsites.net
- **‚úÖ PostgreSQL**: `ev-charge-db` (Ready) - PostgreSQL 17
- **‚öôÔ∏è App Settings**: –ø–æ–≤–Ω—ñ—Å—Ç—é –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –∑ BOT_TOKEN, OWNER_CHAT_ID —Ç–æ—â–æ

### üîß –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø:
```env
OWNER_PHONE_E164=+380933652536
OWNER_CHAT_ID=495068248
BOT_TOKEN=8499449869:AAEmGz5Puqzetv14PjPhPeH8FmhAeOKIdfw
ALLOWED_NEIGHBOR_PHONES=+380982180724  # –Ü–≥–æ—Ä –î–º–∏—Ç—Ä–∏–∫
```

## ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–Ü –ü–†–û–ë–õ–ï–ú–ò:

### 1. **Markdown Parsing Error** - –í–ò–ü–†–ê–í–õ–ï–ù–û ‚úÖ
~~**–°–∏–º–ø—Ç–æ–º**: –ü—Ä–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ —Ñ–æ—Ç–æ –±–æ—Ç –ø–∞–¥–∞—î –∑ –ø–æ–º–∏–ª–∫–æ—é~~
**–†—ñ—à–µ–Ω–Ω—è**: –ó–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ `parse_mode: 'HTML'` —É –≤—Å—ñ—Ö –æ–±—Ä–æ–±–Ω–∏–∫–∞—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

### 2. **HEIC —Ñ–æ—Ä–º–∞—Ç –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è** - –í–ò–ü–†–ê–í–õ–ï–ù–û ‚úÖ
~~**–ü—Ä–æ–±–ª–µ–º–∞**: iPhone –Ω–∞–¥—Å–∏–ª–∞—î —Ñ–æ—Ç–æ –≤ HEIC —Ñ–æ—Ä–º–∞—Ç—ñ~~
**–†—ñ—à–µ–Ω–Ω—è**: –î–æ–¥–∞–Ω–æ Sharp –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—é HEIC‚ÜíJPG –¥–ª—è –≤—Å—ñ—Ö —Ñ–æ—Ç–æ

### 3. **node-tesseract-ocr –∫—Ä–∞—à** - –í–ò–ü–†–ê–í–õ–ï–ù–û ‚úÖ
~~**–ü—Ä–æ–±–ª–µ–º–∞**: OCR –æ–±—Ä–æ–±–∫–∞ –∑–∞–≤–∏—Å–∞–ª–∞ —ñ –∫—Ä–∞—à–∏–ª–∞ –±–æ—Ç~~
**–†—ñ—à–µ–Ω–Ω—è**: –í—ñ–¥–∫–ª—é—á–µ–Ω–æ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–∏–π –º–æ–¥—É–ª—å, fallback –Ω–∞ tesseract.js –∑ timeout

### 4. **Database connection errors** - –í–ò–ü–†–ê–í–õ–ï–ù–û ‚úÖ  
~~**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–º–∏–ª–∫–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ PostgreSQL –≤ development~~
**–†—ñ—à–µ–Ω–Ω—è**: –î–æ–¥–∞–Ω–æ in-memory fallback –¥–ª—è development mode

### 5. **Tariff system missing** - –í–ò–ü–†–ê–í–õ–ï–ù–û ‚úÖ
~~**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–º–∞–Ω–¥–∞ /tariff –ø–æ–∫–∞–∑—É–≤–∞–ª–∞ "–≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ"~~
**–†—ñ—à–µ–Ω–Ω—è**: –ü–æ–≤–Ω—ñ—Å—Ç—é —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ç–∞—Ä–∏—Ñ—ñ–≤ –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é

## ‚ö†Ô∏è –ó–ê–õ–ò–®–ö–û–í–Ü –ü–†–û–ë–õ–ï–ú–ò:

### 1. **PDF —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ —Å–∏–º–≤–æ–ª–∏**
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö—Ä–∞–∫–æ–∑—è–±–ª–∏ –∑–∞–º—ñ—Å—Ç—å —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏—Ö –ª—ñ—Ç–µ—Ä —É PDF
**–ü—Ä–∏–∫–ª–∞–¥**: `At2EdB C√¥@C√¢2C‚ÄûBD0D$8 C√î0 CT;CT:D$@C√§5C√î5D3EdN`
**–†—ñ—à–µ–Ω–Ω—è**: –ü–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π —à—Ä–∏—Ñ—Ç –¥–æ PDFKit

### 2. **OCR —Ç–æ—á–Ω—ñ—Å—Ç—å —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è**
**–ü—Ä–æ–±–ª–µ–º–∞**: 220560.0 –∑–∞–º—ñ—Å—Ç—å 5212.6 –Ω–∞ —Ñ–æ—Ç–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞
**–†—ñ—à–µ–Ω–Ω—è**: –ü–æ—Ç—Ä—ñ–±–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Azure AI Document Intelligence

## üìã –¢–ï–°–¢–£–í–ê–ù–ù–Ø –ü–†–û–í–ï–î–ï–ù–û (–û–ù–û–í–õ–ï–ù–û):

### ‚úÖ –£—Å–ø—ñ—à–Ω—ñ —Ç–µ—Å—Ç–∏ (21.08.2025):
‚úÖ `/start` - –ø–æ–∫–∞–∑—É—î –º–µ–Ω—é –≤–ª–∞—Å–Ω–∏–∫–∞ –∑ –∫–Ω–æ–ø–∫–∞–º–∏  
‚úÖ `/new` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó —Å–µ—Å—ñ—ó –∑–∞—Ä—è–¥–∫–∏  
‚úÖ `/finish` - –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Å–µ—Å—ñ—ó –∑ –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–º —Ñ–æ—Ç–æ –µ–∫—Ä–∞–Ω—É  
‚úÖ `/status` - –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å—É  
‚úÖ `/tariff 2025-08 7.50` - –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞—Ä–∏—Ñ—É  
‚úÖ `/report 2025-08` - –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è PDF —Ç–∞ CSV –∑–≤—ñ—Ç—ñ–≤  
‚úÖ –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Ñ–æ—Ç–æ HEIC —è–∫ –¥–æ–∫—É–º–µ–Ω—Ç - OCR –ø—Ä–∞—Ü—é—î  
‚úÖ –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Å—Ç–∏—Å–Ω–µ–Ω–æ–≥–æ —Ñ–æ—Ç–æ - OCR –ø—Ä–∞—Ü—é—î  
‚úÖ –Ü–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∏ (—Ñ–æ—Ç–æ –î–û/–ü–Ü–°–õ–Ø/–µ–∫—Ä–∞–Ω, –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è)  
‚úÖ Smart number recognition (–ª—ñ—á–∏–ª—å–Ω–∏–∫ vs –µ–∫—Ä–∞–Ω)  
‚úÖ Session management (—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è)  
‚úÖ Context-aware OCR –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º–∏ –ø–æ–∫–∞–∑–Ω–∏–∫–∞–º–∏  

### ‚ö†Ô∏è –¢–µ—Å—Ç–∏ —â–æ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:
‚ö†Ô∏è OCR —Ç–æ—á–Ω—ñ—Å—Ç—å - —Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–Ω—è –¥–µ—è–∫–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤ –ø–æ—Ç—Ä–µ–±—É—î –∫–æ—Ä–µ–∫—Ü—ñ—ó  
‚ö†Ô∏è PDF —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ —Å–∏–º–≤–æ–ª–∏ - –∫—Ä–∞–∫–æ–∑—è–±–ª–∏ –∑–∞–º—ñ—Å—Ç—å —Ç–µ–∫—Å—Ç—É  

## üöÄ –ì–û–¢–û–í–ù–Ü–°–¢–¨ –î–û PRODUCTION:

### –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å: **95% –≥–æ—Ç–æ–≤–æ**
- **Core functionality**: ‚úÖ 100% (—Å–µ—Å—ñ—ó, —Ç–∞—Ä–∏—Ñ–∏, –∑–≤—ñ—Ç–∏)
- **Azure infrastructure**: ‚úÖ 90% (—Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ, –ø–æ—Ç—Ä—ñ–±–Ω—ñ credentials)
- **OCR processing**: ‚úÖ 80% (–ø—Ä–∞—Ü—é—î, –ø–æ—Ç—Ä—ñ–±–Ω–µ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è)
- **Reports**: ‚úÖ 85% (CSV –≥–æ—Ç–æ–≤–æ, PDF –ø–æ—Ç—Ä–µ–±—É—î —à—Ä–∏—Ñ—Ç)
- **UX/UI**: ‚úÖ 95% (–≤—Å—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å)

### –ó–∞–ª–∏—à–∏–ª–æ—Å—è –¥–æ production:
1. ‚ö° –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Azure database credentials (10 —Ö–≤)
2. üî§ –í–∏–ø—Ä–∞–≤–∏—Ç–∏ PDF —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π —à—Ä–∏—Ñ—Ç (20 —Ö–≤) 
3. üîó –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ webhook –≤ Telegram (5 —Ö–≤)
4. üß™ End-to-end —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ Azure (30 —Ö–≤)

**ETA**: –≥–æ—Ç–æ–≤–æ –¥–æ production –∑–∞ 1 –≥–æ–¥–∏–Ω—É

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–£:
```
ev-charge-bot/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.js              ‚úÖ –û—Å–Ω–æ–≤–Ω–∏–π —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js          ‚úÖ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands/         ‚úÖ –ö–æ–º–∞–Ω–¥–∏ –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ handlers/         ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –∑ markdown
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.js           ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ setup.js          ‚úÖ PostgreSQL —Å—Ö–µ–º–∞
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ logger.js         ‚úÖ –õ–æ–≥—É–≤–∞–Ω–Ω—è
‚îú‚îÄ‚îÄ .env                      ‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
‚îú‚îÄ‚îÄ package.json              ‚úÖ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îú‚îÄ‚îÄ README.md                 ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
‚îî‚îÄ‚îÄ SETUP.md                  ‚úÖ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó Azure
```

## üîÑ –ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò:
1. –í–∏–ø—Ä–∞–≤–∏—Ç–∏ markdown –ø–æ–º–∏–ª–∫–∏
2. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ —Å—É—Å—ñ–¥–æ–º
3. Azure deployment
4. –°–ø—Ä–∞–≤–∂–Ω—ñ–π OCR (Tesseract.js)
5. PDF –∑–≤—ñ—Ç–∏

## üë• –ö–û–†–ò–°–¢–£–í–ê–ß–Ü:
- **–í–ª–∞—Å–Ω–∏–∫**: –ï–ª—å–¥–∞—Ä (chat_id: 495068248, phone: +380933652536)
- **–°—É—Å—ñ–¥**: –Ü–≥–æ—Ä –î–º–∏—Ç—Ä–∏–∫ (phone: +380982180724) - –Ω–µ —Ç–µ—Å—Ç—É–≤–∞–≤—Å—è

---
*–°—Ç–∞—Ç—É—Å –∑–±–µ—Ä–µ–∂–µ–Ω–æ: 21.08.2025 15:01*