# EV Charge Bot - Claude Code Context

## –ü—Ä–æ–µ–∫—Ç: Telegram –±–æ—Ç –¥–ª—è —Ç—Ä–µ–∫—ñ–Ω–≥—É –∑–∞—Ä—è–¥–∫–∏ –µ–ª–µ–∫—Ç—Ä–æ–º–æ–±—ñ–ª—è

### üéØ –û—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞
Telegram –±–æ—Ç –¥–ª—è –≤–ª–∞—Å–Ω–∏–∫—ñ–≤ –µ–ª–µ–∫—Ç—Ä–æ–º–æ–±—ñ–ª—ñ–≤ (–ï–ª—å–¥–∞—Ä —Ç–∞ –í—ñ—Ç–∞) –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç –Ω–∞ –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—é –ø—Ä–∏ –∑–∞—Ä—è–¥—Ü—ñ —Ç–∞ –¥—ñ–ª–µ–Ω–Ω—è –∑–≤—ñ—Ç—ñ–≤ –∑ —Å—É—Å—ñ–¥–∞–º–∏.

## üìä –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –ø—Ä–æ—î–∫—Ç—É (21.08.2025 - –û–Ω–æ–≤–ª–µ–Ω–æ)

### ‚úÖ –©–æ –ø—Ä–∞—Ü—é—î (–í–ò–ü–†–ê–í–õ–ï–ù–û):
- **Telegram –±–æ—Ç**: @ev_charge_tracker_bot (—Ç–æ–∫–µ–Ω: 8499449869:AAEmGz5Puqzetv14PjPhPeH8FmhAeOKIdfw)
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –≤–ª–∞—Å–Ω–∏–∫–∞**: Chat ID 495068248 (–ï–ª—å–¥–∞—Ä) —Ä–æ–∑–ø—ñ–∑–Ω–∞—î—Ç—å—Å—è
- **–ë–∞–∑–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏**: `/start`, `/new`, `/finish`, `/status` –ø–æ–≤–Ω—ñ—Å—Ç—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ
- **–ö–æ–º–∞–Ω–¥–∞ `/tariff`**: –ø–æ–≤–Ω—ñ—Å—Ç—é —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –∑ in-memory fallback –¥–ª—è development
- **OCR –æ–±—Ä–æ–±–∫–∞**: Tesseract.js –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é + timeout –∑–∞—Ö–∏—Å—Ç
- **Session management**: –ø–æ–≤–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Å—ñ—è–º–∏ –∑ database fallback
- **PDF/CSV –∑–≤—ñ—Ç–∏**: –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø—Ä–∞—Ü—é—î (CSV –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ, PDF - –≤ —Ä–æ–±–æ—Ç—ñ)
- **HEIC –ø—ñ–¥—Ç—Ä–∏–º–∫–∞**: –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤ JPG —á–µ—Ä–µ–∑ Sharp
- **Smart number recognition**: —Ä–æ–∑—Ä—ñ–∑–Ω–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫ vs –µ–∫—Ä–∞–Ω –∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- **–Ü–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∏**: –≤—Å—ñ callback –∑–∞–ø–∏—Ç–∏ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ
- **–õ–æ–≥—É–≤–∞–Ω–Ω—è**: –ø–æ–≤–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- **VS Code –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è**: –ø–æ–≤–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏

### üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏:
- ‚úÖ **Markdown Parsing Error**: –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ HTML parsing
- ‚úÖ **node-tesseract-ocr –∫—Ä–∞—à**: –≤—ñ–¥–∫–ª—é—á–µ–Ω–æ, fallback –Ω–∞ tesseract.js
- ‚úÖ **Database connection errors**: –¥–æ–¥–∞–Ω–æ development mode fallback
- ‚úÖ **Tariff system**: –ø–æ–≤–Ω—ñ—Å—Ç—é —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é
- ‚úÖ **Session completion**: –ø—Ä–∞–≤–∏–ª—å–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Å–µ—Å—ñ–π –∑ —Ç–∞—Ä–∏—Ñ–∞–º–∏
- ‚úÖ **CSV format**: –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –∑ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π CSV
- ‚úÖ **Statistics calculation**: –ø–æ–∫–∞–∑—É—î —Ä–µ–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ –∑–∞–º—ñ—Å—Ç—å 0

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∏ —â–æ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è:
- **PDF encoding**: —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ —Å–∏–º–≤–æ–ª–∏ –≤—Å–µ —â–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è —è–∫ –∫—Ä–∞–∫–æ–∑—è–±–ª–∏ (–ø–æ—Ç—Ä—ñ–±–µ–Ω —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —à—Ä–∏—Ñ—Ç)
- **OCR accuracy**: –ø–æ—Ç—Ä–µ–±—É—î –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –Ω–æ–º–µ—Ä—ñ–≤ (220560.0 –∑–∞–º—ñ—Å—Ç—å 5212.6)

### üÜï –ù–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:
- **Context-aware OCR**: –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º–∏ –ø–æ–∫–∞–∑–Ω–∏–∫–∞–º–∏
- **Power validation**: –ª–æ–≥—ñ–∫–∞ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è
- **Session recovery**: —Å–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∫—Ä–∞—à—ñ–≤
- **Enhanced UX**: –ø–æ–∫—Ä–∞—â–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ /finish –∑ –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–º —Ñ–æ—Ç–æ –µ–∫—Ä–∞–Ω—É

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ—Ö–Ω—ñ—á–Ω–∏–π —Å—Ç–µ–∫:
- **Backend**: Node.js + Express + grammy (Telegram Bot API)
- **Database**: PostgreSQL (Azure Database for PostgreSQL Flexible Server)
- **Storage**: Azure Blob Storage –¥–ª—è –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏—Ö —Ñ–æ—Ç–æ
- **OCR**: Tesseract.js –¥–ª—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤ –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤
- **Reports**: jsPDF –¥–ª—è PDF, csv-writer –¥–ª—è CSV
- **Auth**: Azure Key Vault –¥–ª—è —Å–µ–∫—Ä–µ—Ç—ñ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É:
```
src/
‚îú‚îÄ‚îÄ index.js              ‚úÖ –ì–æ–ª–æ–≤–Ω–∏–π —Å–µ—Ä–≤–µ—Ä (Express + grammy)
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ index.js          ‚úÖ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–æ—Ç–∞ –∑ middleware
‚îÇ   ‚îú‚îÄ‚îÄ commands/         ‚úÖ –ö–æ–º–∞–Ω–¥–∏ –±–æ—Ç–∞ (/start, /new, /finish)
‚îÇ   ‚îî‚îÄ‚îÄ handlers/         ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –∑ Markdown parsing
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ auth.js           ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –≤–ª–∞—Å–Ω–∏–∫–∞/—Å—É—Å—ñ–¥—ñ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ocr.js            üöß OCR –¥–ª—è –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤ (TODO)
‚îÇ   ‚îú‚îÄ‚îÄ storage.js        üöß Azure Blob Storage (TODO)
‚îÇ   ‚îî‚îÄ‚îÄ reports.js        üöß PDF/CSV –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è (TODO)
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ setup.js          ‚úÖ PostgreSQL —Å—Ö–µ–º–∞ (sessions, files, tariffs, neighbors, otp_links, audit_log)
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ logger.js         ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è
```

## üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–∞ —Ä–æ–ª—ñ

### –í–ª–∞—Å–Ω–∏–∫ (–ï–ª—å–¥–∞—Ä):
- **–¢–µ–ª–µ—Ñ–æ–Ω**: +380933652536  
- **Chat ID**: 495068248
- **–†–æ–ª—å**: OWNER (–ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø)
- **–ö–æ–º–∞–Ω–¥–∏**: `/start`, `/new`, `/finish`, `/status`, `/report YYYY-MM`, `/tariff YYYY-MM value`

### –°—É—Å—ñ–¥ (–Ü–≥–æ—Ä –î–º–∏—Ç—Ä–∏–∫):
- **–¢–µ–ª–µ—Ñ–æ–Ω**: +380982180724
- **–†–æ–ª—å**: NEIGHBOR (–ø–µ—Ä–µ–≥–ª—è–¥ –∑–≤—ñ—Ç—ñ–≤)
- **–ö–æ–º–∞–Ω–¥–∏**: `/start`, `/view YYYY-MM`, `/confirm YYYY-MM`

## üîÑ –†–æ–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å –±–æ—Ç–∞

### –°—Ü–µ–Ω–∞—Ä—ñ–π –∑–∞—Ä—è–¥–∫–∏:
1. **–í–ª–∞—Å–Ω–∏–∫**: `/tariff 2025-01 5.50` - –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ç–∞—Ä–∏—Ñ
2. **–í–ª–∞—Å–Ω–∏–∫**: `/new` - —Ä–æ–∑–ø–æ—á–∞—Ç–∏ —Å–µ—Å—ñ—é –∑–∞—Ä—è–¥–∫–∏
3. **–í–ª–∞—Å–Ω–∏–∫**: –Ω–∞–¥—Å–∏–ª–∞—î —Ñ–æ—Ç–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –î–û —è–∫ –¥–æ–∫—É–º–µ–Ω—Ç
4. **–í–ª–∞—Å–Ω–∏–∫**: `/finish` - –∑–∞–≤–µ—Ä—à–∏—Ç–∏ —Å–µ—Å—ñ—é
5. **–í–ª–∞—Å–Ω–∏–∫**: –Ω–∞–¥—Å–∏–ª–∞—î —Ñ–æ—Ç–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –ü–Ü–°–õ–Ø + –µ–∫—Ä–∞–Ω –∑–∞—Ä—è–¥–∫–∏
6. **–°–∏—Å—Ç–µ–º–∞**: OCR —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è ‚Üí –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó ‚Üí —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∫–í—Ç¬∑–≥–æ–¥
7. **–í–ª–∞—Å–Ω–∏–∫**: –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î –¥–∞–Ω—ñ —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î —Å–µ—Å—ñ—é
8. **–í–ª–∞—Å–Ω–∏–∫**: `/report 2025-01` - –≥–µ–Ω–µ—Ä—É—î PDF/CSV –∑–≤—ñ—Ç
9. **–°—É—Å—ñ–¥**: –æ—Ç—Ä–∏–º—É—î OTP-–ø–æ—Å–∏–ª–∞–Ω–Ω—è –∞–±–æ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω—è –≤—ñ–¥ –≤–ª–∞—Å–Ω–∏–∫–∞
10. **–°—É—Å—ñ–¥**: `/view 2025-01` + `/confirm 2025-01`

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö (PostgreSQL)

### –û—Å–Ω–æ–≤–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ:
- **sessions**: —Å–µ—Å—ñ—ó –∑–∞—Ä—è–¥–∫–∏ (–î–û/–ü–Ü–°–õ–Ø/–∫–í—Ç¬∑–≥–æ–¥/—Å—É–º–∞)
- **files**: —Ñ–æ—Ç–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤ –∑ EXIF —Ç–∞ SHA-256
- **tariffs**: —Ç–∞—Ä–∏—Ñ–∏ –ø–æ –º—ñ—Å—è—Ü—è—Ö (–≥—Ä–Ω/–∫–í—Ç¬∑–≥–æ–¥)
- **neighbors**: –¥–æ–∑–≤–æ–ª–µ–Ω—ñ —Å—É—Å—ñ–¥–∏ –∑ whitelist
- **otp_links**: –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑ TTL
- **audit_log**: –ø–æ–≤–Ω–∏–π –∞—É–¥–∏—Ç –≤—Å—ñ—Ö –¥—ñ–π

## ‚òÅÔ∏è Azure Infrastructure (–†–û–ó–ì–û–†–ù–£–¢–û)

### ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ –≤ Resource Group: `ev-charge-bot-rg` (Poland Central):
- **‚úÖ App Service Plan**: `eldar_asp_3511` (Basic B1) - Running
- **‚úÖ Web App**: `ev-charge-bot` - Running –Ω–∞ ev-charge-bot.azurewebsites.net
- **‚úÖ PostgreSQL Flexible Server**: `ev-charge-db` - Ready (PostgreSQL 17)
  - URL: ev-charge-db.postgres.database.azure.com
  - Database: postgres
- **üöß Storage Account**: –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –¥–ª—è —Ñ–æ—Ç–æ storage
- **üöß Key Vault**: –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –¥–ª—è —Å–µ–∫—Ä–µ—Ç—ñ–≤

### ‚öôÔ∏è App Settings (–Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ):
```
NODE_ENV=production
BOT_TOKEN=8499449869:AAEmGz5Puqzetv14PjPhPeH8FmhAeOKIdfw
WEBHOOK_URL=https://ev-charge-bot.azurewebsites.net/webhook
OWNER_PHONE_E164=+380933652536
OWNER_CHAT_ID=495068248
ALLOWED_NEIGHBOR_PHONES=+380982180724
DEFAULT_RATE_UAH=5.50
DATABASE_URL=postgresql://temp:temp@ev-charge-db.postgres.database.azure.com:5432/postgres?sslmode=require
```

### üîÑ –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å deployment:
- **Infrastructure**: ‚úÖ –ì–æ—Ç–æ–≤–æ (App Service + PostgreSQL)
- **Configuration**: ‚ö†Ô∏è DATABASE_URL –ø–æ—Ç—Ä–µ–±—É—î –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö credentials
- **Code deployment**: üöß –ì–æ—Ç–æ–≤–æ –¥–æ push
- **Database schema**: üöß –ü–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó
- **Webhook setup**: üöß –ü–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –≤ Telegram

**–ó–∞–≥–∞–ª—å–Ω–∏–π –±—é–¥–∂–µ—Ç**: ~$35/–º—ñ—Å = $420/—Ä—ñ–∫ (–≤ –º–µ–∂–∞—Ö $2000/—Ä—ñ–∫)

## üõ†Ô∏è –ü–æ—Ç–æ—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è (–æ–Ω–æ–≤–ª–µ–Ω–æ)

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è:
1. ‚úÖ **Markdown parsing error** - –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ HTML
2. ‚úÖ **HEIC –ø—ñ–¥—Ç—Ä–∏–º–∫–∞** - Sharp –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤ JPG
3. ‚úÖ **OCR —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è** - Tesseract.js –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é
4. ‚úÖ **–ö–æ–º–∞–Ω–¥–∞ /tariff** - –ø–æ–≤–Ω—ñ—Å—Ç—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∞ 
5. ‚úÖ **CSV –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è** - –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç
6. ‚úÖ **Session management** - –ø–æ–≤–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∑ fallback
7. ‚úÖ **Database fallback** - development mode –±–µ–∑ PostgreSQL
8. ‚úÖ **Azure infrastructure** - App Service + PostgreSQL —Å—Ç–≤–æ—Ä–µ–Ω–æ

### üîÑ –í —Ä–æ–±–æ—Ç—ñ (–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 1):
1. **Azure deployment** - –∑–∞–≤–µ—Ä—à–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
2. **PDF encoding fix** - –¥–æ–¥–∞—Ç–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π —à—Ä–∏—Ñ—Ç –¥–æ PDFKit
3. **Database migrations** - –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å—Ö–µ–º—É –Ω–∞ Azure PostgreSQL

### üìã –ù–∞—Å—Ç—É–ø–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è (–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 2):
4. **OCR accuracy** - –ø–æ–∫—Ä–∞—â–∏—Ç–∏ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –Ω–æ–º–µ—Ä—ñ–≤ —á–µ—Ä–µ–∑ Azure AI
5. **Power validation** - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è 8A=1.76kW vs 16A=3.52kW
6. **Session duration validation** - —á–∞—Å vs —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –∫–í—Ç¬∑–≥–æ–¥
7. **Neighbor management** - —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `/setneighbor` –∫–æ–º–∞–Ω–¥—É
8. **Report sharing** - —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `/share` –∫–æ–º–∞–Ω–¥—É

### üöÄ –î–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ –∑–∞–≤–¥–∞–Ω–Ω—è:
9. **Session recovery** - –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∫—Ä–∞—à—ñ–≤
10. **Azure AI OCR integration** - –∫—Ä–∞—âe —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤
11. **OTP-–ø–æ—Å–∏–ª–∞–Ω–Ω—è** - –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∏–π –¥–æ—Å—Ç—É–ø –¥–ª—è —Å—É—Å—ñ–¥—ñ–≤
12. **Blob Storage** - –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏—Ö —Ñ–æ—Ç–æ –∑ EXIF

## üîê –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### Environment variables:
```env
BOT_TOKEN=8499449869:AAEmGz5Puqzetv14PjPhPeH8FmhAeOKIdfw
OWNER_PHONE_E164=+380933652536
OWNER_CHAT_ID=495068248
ALLOWED_NEIGHBOR_PHONES=+380982180724
DEFAULT_RATE_UAH=5.50
```

### Azure resources naming:
- Resource Group: `ev-charge-bot-rg`
- App Service: `ev-charge-bot`
- PostgreSQL: `ev-charge-db`
- Storage Account: `evchargestorage`
- Container: `ev-charging`

## üìù –ö–æ–º–∞–Ω–¥–∏ —Ä–æ–∑—Ä–æ–±–∫–∏

```bash
# –†–æ–∑—Ä–æ–±–∫–∞ –∑ auto-reload
npm run dev

# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
npm run test-config

# Production –∑–∞–ø—É—Å–∫
npm start

# Azure deployment
az webapp up --name ev-charge-bot --resource-group ev-charge-bot-rg
```

## üìà –ü—Ä–æ–≥—Ä–µ—Å —Ä–æ–∑—Ä–æ–±–∫–∏

### üéØ –ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–æ production:
- **–õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞**: ‚úÖ 98% –≥–æ—Ç–æ–≤–æ
- **–û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å**: ‚úÖ –ü–æ–≤–Ω—ñ—Å—Ç—é –ø—Ä–∞—Ü—é—î (Tariff + Session + Reports)
- **Azure infrastructure**: ‚úÖ 90% –≥–æ—Ç–æ–≤–æ (App Service + PostgreSQL —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ)
- **Database integration**: üîÑ 85% (fallback –ø—Ä–∞—Ü—é—î, –ø–æ—Ç—Ä—ñ–±–Ω—ñ credentials)
- **OCR processing**: ‚úÖ 80% (–ø—Ä–∞—Ü—é—î –∑ timeout, –ø–æ—Ç—Ä—ñ–±–Ω–µ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Ç–æ—á–Ω–æ—Å—Ç—ñ)
- **Reports generation**: ‚úÖ 85% (CSV –≥–æ—Ç–æ–≤–æ, PDF –ø–æ—Ç—Ä–µ–±—É—î —à—Ä–∏—Ñ—Ç)

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–º—ñ–Ω (—Å–µ—Å—ñ—è 21.08.2025):
- **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –±–∞–≥—ñ–≤**: 8
- **–î–æ–¥–∞–Ω–æ –Ω–æ–≤–æ—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ**: 5 
- **–ü–æ–∫—Ä–∞—â–µ–Ω–æ UX**: 3
- **–û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**: 2
- **–°—Ç–≤–æ—Ä–µ–Ω–æ Azure resources**: 3

### üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ –¥–ª—è production:
1. ‚ö° –ó–∞–≤–µ—Ä—à–∏—Ç–∏ Azure database connection (15 —Ö–≤)
2. üî§ –í–∏–ø—Ä–∞–≤–∏—Ç–∏ PDF —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π —à—Ä–∏—Ñ—Ç (30 —Ö–≤)
3. üóÑÔ∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ database migrations (10 —Ö–≤)
4. üîó –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Telegram webhook (5 —Ö–≤)
5. üß™ –ü—Ä–æ–≤–µ—Å—Ç–∏ end-to-end —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è (60 —Ö–≤)

**ETA –¥–æ production**: ~2 –≥–æ–¥–∏–Ω–∏

---
*–ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è Claude Code - 21.08.2025 22:00*