# EV Charge Bot - –†–æ–∑–º–æ–≤–∞ –∑ Claude Code

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç—É

–¶–µ –ø—Ä–æ–µ–∫—Ç Telegram-–±–æ—Ç–∞ –¥–ª—è —Ç—Ä–µ–∫—ñ–Ω–≥—É –∑–∞—Ä—è–¥–∫–∏ –µ–ª–µ–∫—Ç—Ä–æ–º–æ–±—ñ–ª—è –∑ Azure –±–µ–∫–µ–Ω–¥–æ–º. –ï–ª—å–¥–∞—Ä —Ç–∞ –í—ñ—Ç–∞ (–≤–ª–∞—Å–Ω–∏–∫–∏) —Ö–æ—á—É—é—Ç—å –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—é –¥–ª—è –∑–∞—Ä—è–¥–∫–∏ –µ–ª–µ–∫—Ç—Ä–æ–º–æ–±—ñ–ª—è —Ç–∞ –¥—ñ–ª–∏—Ç–∏—Å—è –∑–≤—ñ—Ç–∞–º–∏ –∑ —Å—É—Å—ñ–¥–∞–º–∏.

## –ü–æ—á–∞—Ç–∫–æ–≤–∞ —Ä–æ–∑–º–æ–≤–∞

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** –°–ø–æ—á–∞—Ç–∫—É –±—É–ª–∞ –ø—Ä–æ—Å—Ç–∏–π React –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –¥–ª—è —Ç—Ä–µ–∫—ñ–Ω–≥—É –∑–∞—Ä—è–¥–∫–∏, –∞–ª–µ –ø–æ—Ç—ñ–º –≤–∏—Ä—ñ—à–∏–ª–∏ —â–æ –∫—Ä–∞—â–µ –±—É–¥–µ Telegram –±–æ—Ç.

## –î–µ—Ç–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω (–í–ê–†–Ü–ê–ù–¢ B: –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç + Azure)

**–¶—ñ–ª—å:** –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Ä–æ–±–æ—á–∏–π –±–æ—Ç —É Telegram, —è–∫–∏–π –ø–æ–∫—Ä–∏–≤–∞—î –ø–æ–≤–Ω–∏–π —Ü–∏–∫–ª `/new ‚Üí /finish ‚Üí –∑–≤—ñ—Ç`, –∑–±–µ—Ä—ñ–≥–∞—î –æ—Ä–∏–≥—ñ–Ω–∞–ª–∏ —Ñ–æ—Ç–æ —Ç–∞ –¥–∞–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –≤ Azure —ñ –∑–∞–ª–∏—à–∞—î ¬´–ª—é–¥—Å—å–∫—É¬ª –∫–æ–ø—ñ—é –≤ —á–∞—Ç—ñ. **Viber** –ø—ñ–¥ º—î–¥–Ω—É—î–º–æ —è–∫ –¥—Ä—É–≥–æ—Ä—è–¥–Ω–∏–π –∫–∞–Ω–∞–ª –ø—ñ—Å–ª—è MVP (—Å–ø—ñ–ª—å–Ω–∞ –ª–æ–≥—ñ–∫–∞, –æ–∫—Ä–µ–º–∏–π –∞–¥–∞–ø—Ç–µ—Ä).

### 1) –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ (Telegram-first)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:**
- **Telegram Bot (Webhook)** ‚Üí **Bot API**
- **API/–±–µ–∫–µ–Ω–¥** (Azure App Service –∞–±–æ Azure Functions HTTP): –ø—Ä–∏–π–æ–º –≤–µ–±—Ö—É–∫—ñ–≤, –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞, –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–≤—ñ—Ç—ñ–≤
- **–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö** (Azure Database for PostgreSQL Flexible Server): —Å–µ—Å—ñ—ó, —Ç–∞—Ä–∏—Ñ–∏, —Ñ–∞–π–ª–∏, —Ä–æ–ª—ñ, OTP
- **–§–∞–π–ª–æ–≤–µ —Å—Ö–æ–≤–∏—â–µ** (Azure Blob Storage): –æ—Ä–∏–≥—ñ–Ω–∞–ª–∏ —Ñ–æ—Ç–æ (–î–û/–ü–Ü–°–õ–Ø/–µ–∫—Ä–∞–Ω), –ø—Ä–µ–≤ º—é, —Ç–∏–º—á–∞—Å–æ–≤—ñ —Ñ–∞–π–ª–∏ –∑–≤—ñ—Ç—ñ–≤
- **OCR-–ø–∞–π–ø–ª–∞–π–Ω**: 1) –≤–±—É–¥–æ–≤–∞–Ω–∏–π Tesseract (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π) —è–∫ –¥–µ—Ñ–æ–ª—Ç; 2) –æ–ø—Ü—ñ—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ Azure Cognitive Services OCR
- **PDF/CSV-–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è**: headless-–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –Ω–∞ –±–µ–∫–µ–Ω–¥—ñ (HTML‚ÜíPDF) + —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π CSV
- **Key Vault**: –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤/—Å–µ–∫—Ä–µ—Ç—ñ–≤
- **App Insights/–ª–æ–≥—É–≤–∞–Ω–Ω—è**: –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–µ–±—Ö—É–∫—ñ–≤, –ø–æ–º–∏–ª–æ–∫ OCR, –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–≤—ñ—Ç—ñ–≤

### 2) –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —Å—É—Å—ñ–¥–∞ –∑–∞ –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω—É

**Telegram:**
- –ë–æ—Ç –Ω–∞–¥—Å–∏–ª–∞—î –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É –∑ –∫–Ω–æ–ø–∫–æ—é **¬´–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º¬ª** (request_contact)
- –û—Ç—Ä–∏–º–∞–Ω–∏–π –Ω–æ–º–µ—Ä –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î—Ç—å—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç **E.164** —ñ –∑–≤—ñ—Ä—è—î—Ç—å—Å—è –∑—ñ **—Å–ø–∏—Å–∫–æ–º –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤**
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: **OTP-–ø–æ—Å–∏–ª–∞–Ω–Ω—è** (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∏–π —Ç–æ–∫–µ–Ω —ñ–∑ TTL)

### 3) –ë–æ—Ç: –∫–æ–º–∞–Ω–¥–∏, –µ–∫—Ä–∞–Ω–∏, UX

**–ö–æ–º–∞–Ω–¥–∏ (–¥–ª—è –≤–ª–∞—Å–Ω–∏–∫–∞):** 
- `/start`, `/help`, `/new`, `/finish`, `/status`
- `/report YYYY-MM`, `/tariff YYYY-MM value`, `/setneighbor`, `/share YYYY-MM`

**–ö–æ–º–∞–Ω–¥–∏ (–¥–ª—è —Å—É—Å—ñ–¥–∞):** 
- `/view YYYY-MM` (–ø—ñ–¥—Å—É–º–æ–∫ + –ø—Ä–µ–≤ º—é)
- `/confirm YYYY-MM` (–ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —Å—É–º—É)

**–ö–ª—é—á–æ–≤—ñ –µ–∫—Ä–∞–Ω–∏-—Ä–µ–ø–ª–∞—ó:**
- **–ü–æ—á–∞—Ç–æ–∫ (/new):** —ñ–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ ¬´–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ñ–æ—Ç–æ –î–û¬ª ‚Üí –ø—ñ–¥–∫–∞–∑–∫–∞ ¬´–ù–∞–¥—ñ—à–ª—ñ—Ç—å —è–∫ *–§–∞–π–ª/–î–æ–∫—É–º–µ–Ω—Ç*, —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏ EXIF¬ª
- **–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è (/finish):** –∑–∞–ø–∏—Ç —Ñ–æ—Ç–æ –ü–Ü–°–õ–Ø + –µ–∫—Ä–∞–Ω–∞; –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∫–í—Ç¬∑–≥–æ–¥; –±–∞–Ω–µ—Ä –ø—Ä–æ —Ä–æ–∑–±—ñ–∂–Ω—ñ—Å—Ç—å > X%; —Å–µ–ª–µ–∫—Ç–æ—Ä ¬´–î–∂–µ—Ä–µ–ª–æ —ñ—Å—Ç–∏–Ω–∏¬ª (–ª—ñ—á–∏–ª—å–Ω–∏–∫/–µ–∫—Ä–∞–Ω/–≤—Ä—É—á–Ω—É) + –∫–æ–º–µ–Ω—Ç–∞—Ä
- **–ó–≤—ñ—Ç (/report):** PDF + CSV —É —á–∞—Ç; –∫–Ω–æ–ø–∫–∏ ¬´–ü–µ—Ä–µ—Å–ª–∞—Ç–∏ —Å—É—Å—ñ–¥–æ–≤—ñ¬ª, ¬´–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ OTP¬ª, ¬´–ü–æ–∫–∞–∑–∞—Ç–∏ –¥–µ—Ç–∞–ª—ñ —Å–µ—Å—ñ–π¬ª

### 4) –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó

- **–°–µ—Ä–≤–µ—Ä–Ω–∞ –∫–æ–ø—ñ—è:** –∑–∞–ø–∏—Å–∏ –≤ –ë–î + –æ—Ä–∏–≥—ñ–Ω–∞–ª–∏ —Ñ–æ—Ç–æ –≤ Blob Storage; **SHA-256** –¥–ª—è –≤—Å—ñ—Ö —Ñ–∞–π–ª—ñ–≤
- **–õ—é–¥—Å—å–∫–∞ –∫–æ–ø—ñ—è:** –∫–≤–∏—Ç–∞–Ω—Ü—ñ—ó/–∑–≤—ñ—Ç–∏ —É —á–∞—Ç—ñ (–¥–æ—Å—Ç—É–ø–Ω—ñ –∑ —ñ—Å—Ç–æ—Ä—ñ—ó Telegram)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ Blob:**
```
/ev-charging/
  /YYYY/
    /YYYY-MM/
      /{session_id}/
        before_original.jpg
        after_original.jpg
        screen_original.jpg
        before_thumb.jpg
        after_thumb.jpg
        screen_thumb.jpg
        session.json
```

### 5) –°—Ö–µ–º–∞ –¥–∞–Ω–∏—Ö (PostgreSQL)

- **sessions**(id, started_at, finished_at, meter_before, meter_after, kwh_calc, kwh_screen, kwh_agreed, kwh_source, tariff_month, tariff_value, amount_uah, location_lat, location_lon, comment, status, owner_user_id)
- **files**(id, session_id, kind[before|after|screen], blob_url, sha256, width, height, exif_json, created_at)
- **tariffs**(ym, currency, price_uah_per_kwh, source_note, attachment_blob_url, updated_at)
- **neighbors**(id, display_name, phone_e164, tg_chat_id, viber_user_id, is_active, roles[NEIGHBOR], created_at)
- **otp_links**(id, ym, token, role, expires_at, used_at, issued_to)
- **audit_log**(id, at, actor, action, object_type, object_id, meta_json)

### 6) –í–∞–ª—ñ–¥–∞—Ü—ñ—ó –π –±—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ (MVP)

- (–ü–Ü–°–õ–Ø ‚àí –î–û) < 0 ‚Üí –ø–æ–º–∏–ª–∫–∞; = 0 ‚Üí –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è + —è–≤–Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
- –†–æ–∑–±—ñ–∂–Ω—ñ—Å—Ç—å –ª—ñ—á–∏–ª—å–Ω–∏–∫‚Üî–µ–∫—Ä–∞–Ω > X% (–¥–µ—Ñ. 10%) ‚Üí –≤–∏–º–∞–≥–∞—Ç–∏ –≤–∏–±—ñ—Ä ¬´–¥–∂–µ—Ä–µ–ª–∞ —ñ—Å—Ç–∏–Ω–∏¬ª
- –ë–µ–∑ —Ç–∞—Ä–∏—Ñ—É –∑–∞ –º—ñ—Å—è—Ü—å ‚Äî –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Å–µ—Å—ñ—ó –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–µ (—á–µ—Ä–Ω–µ—Ç–∫–∞)
- –ü–∞—Ä–∞ –î–û/–ü–Ü–°–õ–Ø –º–∞—î –±—É—Ç–∏ –≤ –º–µ–∂–∞—Ö ‚â§12 –≥–æ–¥; —ñ–Ω–∞–∫—à–µ ‚Äî –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
- –û–∫—Ä—É–≥–ª–µ–Ω–Ω—è: –∫–í—Ç¬∑–≥–æ–¥ ‚Äî 0.01; UAH ‚Äî 0.01

### 7) –†–æ–ª—ñ —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É

- **OWNER**: –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–º–∞–Ω–¥ —ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å; —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–∞—Ä–∏—Ñ–∞–º–∏; –µ–∫—Å–ø–æ—Ä—Ç
- **NEIGHBOR**: —á–∏—Ç–∞–Ω–Ω—è –ø—ñ–¥—Å—É–º–∫—É –∑–∞ –º—ñ—Å—è—Ü—å, –ø—Ä–µ–≤ º—é —Ñ–æ—Ç–æ, /confirm; –±–µ–∑ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
- **OTP-VIEW**: —Ä–∞–∑–æ–≤–∏–π –ø–µ—Ä–µ–≥–ª—è–¥ –∑–≤—ñ—Ç—É –ø—Ä–æ—Ç—è–≥–æ–º TTL (24 –≥–æ–¥ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)

### 8) –¢–µ–∫—Å—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (—á–µ—Ä–Ω–µ—Ç–∫–∏)

¬´–ù–∞–¥—ñ—à–ª—ñ—Ç—å, –±—É–¥—å –ª–∞—Å–∫–∞, —Ñ–æ—Ç–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –î–û —è–∫ –î–æ–∫—É–º–µ–Ω—Ç, —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏ EXIF. –ü—ñ–¥–∫–∞–∑–∫–∞: —É Telegram –ø—Ä–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ —Ñ–æ—Ç–æ –≤–∏–±–µ—Ä—ñ—Ç—å "–ë–µ–∑ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è / –Ø–∫ —Ñ–∞–π–ª".¬ª

¬´–ü—Ä–∏–π–Ω—è—Ç–æ. –†–æ–∑–ø—ñ–∑–Ω–∞–≤ –ø–æ–∫–∞–∑: {value}. –ó–∞ –ø–æ—Ç—Ä–µ–±–∏ –≤—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ –≤—Ä—É—á–Ω—É.¬ª

¬´–ù–∞–¥—ñ—à–ª—ñ—Ç—å —Ñ–æ—Ç–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –ü–Ü–°–õ–Ø —ñ —Ñ–æ—Ç–æ –µ–∫—Ä–∞–Ω–∞ –∑–∞—Ä—è–¥–∫–∏ (—É –±—É–¥—å-—è–∫–æ–º—É –ø–æ—Ä—è–¥–∫—É).¬ª

¬´–†–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–æ {kwh} –∫–í—Ç¬∑–≥–æ–¥. –†–æ–∑–±—ñ–∂–Ω—ñ—Å—Ç—å —ñ–∑ –µ–∫—Ä–∞–Ω–æ–º {delta}%. –í–∏–±–µ—Ä—ñ—Ç—å –¥–∂–µ—Ä–µ–ª–æ —ñ—Å—Ç–∏–Ω–∏: [–õ—ñ—á–∏–ª—å–Ω–∏–∫] [–ï–∫—Ä–∞–Ω] [–í—Ä—É—á–Ω—É]¬ª

¬´–¢–∞—Ä–∏—Ñ –∑–∞ {ym}: {price} –≥—Ä–Ω/–∫–í—Ç¬∑–≥–æ–¥. –°—É–º–∞: {amount} –≥—Ä–Ω. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏? [–¢–∞–∫] [–°–∫–∞—Å—É–≤–∞—Ç–∏]¬ª

### 9) –ü–ª–∞–Ω –µ—Ç–∞–ø—ñ–≤

**–ï—Ç–∞–ø 1 (MVP):** Telegram –±–æ—Ç, –ë–î, Blob, OCR (Tesseract), –ø–æ–≤–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π /new‚Äì/finish‚Äì/report, PDF/CSV, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∑–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º (share contact) + whitelist, OTP-–ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è.

**–ï—Ç–∞–ø 2:** —Ä–æ–∑—à–∏—Ä–µ–Ω—ñ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è, –∞–Ω—Ç–∏–¥—É–±–ª—å, –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è OCR/—è–∫—ñ—Å—Ç—å —Ñ–æ—Ç–æ, –ª–æ–≥–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—å.

**–ï—Ç–∞–ø 3:** Viber-–∞–¥–∞–ø—Ç–µ—Ä, SMS-–≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Azure Communication Services, –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –≤–µ–±-–ø–µ—Ä–µ–≥–ª—è–¥ –∑–≤—ñ—Ç—É –Ω–∞ –¥–æ–º–µ–Ω—ñ.

### 10) –ß–µ–∫–ª—ñ—Å—Ç –∑–∞–ø—É—Å–∫—É (MVP)

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ **Bot Token** —É Telegram, –∑–∞–¥–∞—Ç–∏ **Webhook URL**
2. –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –±–µ–∫–µ–Ω–¥ (App Service/Functions), –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ **Blob Storage**, **PostgreSQL**, **Key Vault**, **App Insights**
3. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—ñ (–º—ñ–≥—Ä–∞—Ü—ñ—ó), —Å—Ç–≤–æ—Ä–∏—Ç–∏ **—Ç–∞—Ä–∏—Ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è**
4. –î–æ–¥–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫—ñ–≤ (–≤–∞—à—ñ chat_id/–Ω–æ–º–µ—Ä–∏), –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ **—Å–ø–∏—Å–æ–∫ –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤**
5. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ —è–∫ ¬´–¥–æ–∫—É–º–µ–Ω—Ç¬ª, OCR, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ—Å—ñ—ó, –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
6. –ó—ñ–±—Ä–∞—Ç–∏ –ø–µ—Ä—à—ñ —Ç–µ—Å—Ç–æ–≤—ñ —Å–µ—Å—ñ—ó ‚Üí **/report YYYY-MM** ‚Üí PDF/CSV —É —á–∞—Ç
7. –î–æ–¥–∞—Ç–∏ —Å—É—Å—ñ–¥–∞ —á–µ—Ä–µ–∑ **/setneighbor** –∞–±–æ OTP ‚Üí –ø—Ä–æ–π—Ç–∏ —Å—Ü–µ–Ω–∞—Ä—ñ–π **/view + /confirm**

## –ö–†–ò–¢–ò–ß–ù–Ü –ü–†–û–ë–õ–ï–ú–ò (–ü–†–ò–û–†–Ü–¢–ï–¢ 1) üî¥

### 1. **OCR –ø—Ä–æ—Ü–µ—Å–∏–Ω–≥ –±–ª–æ–∫—É—î –±–æ—Ç**
- **–ü—Ä–æ–±–ª–µ–º–∞**: OCR –æ–±—Ä–æ–±–∫–∞ –∑–∞–≤–∏—Å–∞—î —ñ –∫—Ä–∞—à–∏—Ç—å –≤–µ—Å—å –±–æ—Ç
- **–°–∏–º–ø—Ç–æ–º–∏**: "—â–æ—Å—å –∑–∞–≤–∏—Å–ª–æ", –±–æ—Ç –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ –∫–æ–º–∞–Ω–¥–∏
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û - –¥–æ–¥–∞–Ω–æ timeout 30—Å–µ–∫ —Ç–∞ fallback
- **–†—ñ—à–µ–Ω–Ω—è**: –í—ñ–¥–∫–ª—é—á–µ–Ω–æ node-tesseract-ocr, enhanced Tesseract.js –∑ timeout

### 2. **–°–µ—Å—ñ—ó –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ø—ñ—Å–ª—è –∫—Ä–∞—à–∞**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∫—Ä–∞—à—ñ –±–æ—Ç–∞ —Å–µ—Å—ñ—è –≥—É–±–∏—Ç—å—Å—è
- **–°–∏–º–ø—Ç–æ–º–∏**: –ó–≤—ñ—Ç–∏ –ø–æ–∫–∞–∑—É—é—Ç—å "0 —Å–µ—Å—ñ–π" —Ö–æ—á–∞ –¥–∞–Ω—ñ –≤–≤–æ–¥–∏–ª–∏—Å—å
- **–°—Ç–∞—Ç—É—Å**: üîÑ –í —Ä–æ–±–æ—Ç—ñ - –ø–æ—Ç—Ä—ñ–±–Ω–∞ session recovery –ª–æ–≥—ñ–∫–∞

### 3. **–õ–æ–≥—ñ–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Å–µ—Å—ñ—ó**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–º–∞—î –æ–ø—Ü—ñ—ó –∑–∞–≤–µ—Ä—à–∏—Ç–∏ –±–µ–∑ —Ñ–æ—Ç–æ –µ–∫—Ä–∞–Ω–∞
- **–í–∏–º–æ–≥–∞**: –§–æ—Ç–æ –µ–∫—Ä–∞–Ω–∞ –º–∞—î –±—É—Ç–∏ –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–º
- **–°—Ç–∞—Ç—É—Å**: üìã –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∞

## –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ ‚úÖ
- ‚úÖ –ü–æ–≤–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É –∑ Telegram –±–æ—Ç–æ–º
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ OCR –∑ Tesseract.js + timeout –∑–∞—Ö–∏—Å—Ç
- ‚úÖ –õ–æ–≥—ñ–∫–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —á–∏—Å–ª–æ–≤–∏—Ö –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤:
  - `number < 20 && state = FINISHED` ‚Üí –µ–∫—Ä–∞–Ω –∑–∞—Ä—è–¥–∫–∏
  - `number > previous_meter` ‚Üí –ª—ñ—á–∏–ª—å–Ω–∏–∫ –ü–Ü–°–õ–Ø
  - `state = STARTED` ‚Üí –ª—ñ—á–∏–ª—å–Ω–∏–∫ –î–û
- ‚úÖ –ì—ñ–±—Ä–∏–¥–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å–µ—Å—ñ–π (PostgreSQL + in-memory fallback)
- ‚úÖ –ó–≤—ñ—Ç–∏ PDF/CSV –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –∫–æ–¥—É–≤–∞–Ω–Ω—è–º
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –≤–ª–∞—Å–Ω–∏–∫/—Å—É—Å—ñ–¥
- ‚úÖ –ö–æ–º–∞–Ω–¥–∏: `/start`, `/new`, `/finish`, `/status`, `/report`

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ ‚úÖ
- ‚úÖ –õ–æ–≥—ñ–∫–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è: 6.07 ‚Üí –µ–∫—Ä–∞–Ω (–Ω–µ meter)
- ‚úÖ –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è: `\\n` ‚Üí `\n` –≤ —Ç–µ–∫—Å—Ç–∞—Ö
- ‚úÖ PDF: –ø—Ä–∏–±—Ä–∞–Ω–æ –µ–º–æ–¥–∑—ñ, –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ–¥—É–≤–∞–Ω–Ω—è
- ‚úÖ CSV: –¥–æ–¥–∞–Ω–æ BOM –¥–ª—è UTF-8
- ‚úÖ –§–∞–π–ª–∏: InputFile –∑–∞–º—ñ—Å—Ç—å file:// URL
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Ä–∞—Ö—É—î real data –∑–∞–º—ñ—Å—Ç—å —Ç—ñ–ª—å–∫–∏ 'confirmed'

### –ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö:
- **–õ—ñ—á–∏–ª—å–Ω–∏–∫ –î–û**: 5212.6 –∫–í—Ç¬∑–≥–æ–¥
- **–õ—ñ—á–∏–ª—å–Ω–∏–∫ –ü–Ü–°–õ–Ø**: 5219.5 –∫–í—Ç¬∑–≥–æ–¥  
- **–°–ø–æ–∂–∏—Ç–æ –∑–∞ –ª—ñ—á–∏–ª—å–Ω–∏–∫–æ–º**: 6.9 –∫–í—Ç¬∑–≥–æ–¥
- **–ï–∫—Ä–∞–Ω –∑–∞—Ä—è–¥–∫–∏**: 6.07 –∫–í—Ç¬∑–≥–æ–¥
- **–†—ñ–∑–Ω–∏—Ü—è**: 0.83 –∫–í—Ç¬∑–≥–æ–¥ (—Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–æ!)

## TODO –ö—Ä–∏—Ç–∏—á–Ω—ñ

1. üîÑ **Session recovery** –ø—ñ—Å–ª—è –∫—Ä–∞—à–∞ –±–æ—Ç–∞
2. üîÑ **–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–µ —Ñ–æ—Ç–æ –µ–∫—Ä–∞–Ω–∞** –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Å–µ—Å—ñ—ó
3. üîÑ **–í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–æ —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ** (—á–∞—Å —Å–µ—Å—ñ—ó vs –∫–í—Ç¬∑–≥–æ–¥)
4. üìã **–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å OCR** - –±—ñ–ª—å—à–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
5. üìã **Azure deployment** –∑ Azure AI OCR

## TODO –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

1. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Azure —Ä–µ—Å—É—Ä—Å–∏ (App Service, PostgreSQL, Blob Storage)  
2. –°–∏—Å—Ç–µ–º–∞ —Ç–∞—Ä–∏—Ñ—ñ–≤ –∑ GUI
3. –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤
4. –õ–æ–≥—ñ–∫–∞ –∞–Ω—Ç–∏–¥—É–±–ª—å
5. Viber –∞–¥–∞–ø—Ç–µ—Ä

## –¢–µ—Ö–Ω—ñ—á–Ω–∏–π —Å—Ç–µ–∫

- **Backend:** Node.js + Express + grammy (Telegram Bot API)
- **Database:** PostgreSQL (Azure Database for PostgreSQL)
- **Storage:** Azure Blob Storage
- **OCR:** Tesseract.js (+ –æ–ø—Ü—ñ—è Azure Cognitive Services)
- **PDF Generation:** jsPDF
- **CSV Generation:** csv-writer
- **Authentication:** Azure Key Vault –¥–ª—è —Å–µ–∫—Ä–µ—Ç—ñ–≤

## –ë—é–¥–∂–µ—Ç

$2000/—Ä—ñ–∫ –Ω–∞ Azure –ª–µ–≥–∫–æ –ø–æ–∫—Ä–∏—î:
- Azure App Service: ~$10-50/–º—ñ—Å
- PostgreSQL Flexible Server: ~$20-40/–º—ñ—Å
- Blob Storage: ~$5-10/–º—ñ—Å
- Key Vault: ~$1-5/–º—ñ—Å

–ó–∞–≥–∞–ª–æ–º ~$40-100/–º—ñ—Å = $480-1200/—Ä—ñ–∫, —â–æ –¥—É–∂–µ —Ä–æ–∑—É–º–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –±—é–¥–∂–µ—Ç—É.